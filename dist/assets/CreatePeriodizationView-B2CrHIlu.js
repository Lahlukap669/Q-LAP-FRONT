import{a as v}from"./api-DUlGAOJP.js";import{T as C}from"./TrainerHeader-Dx3V7vEH.js";import{A as S}from"./AppAlert-CPz9EppH.js";import{_ as V,c as r,e as k,a as t,b as M,f as w,d as f,k as y,v as x,t as u,F as m,j as h,l as N,o as n}from"./index-Da2PU-7I.js";const T={name:"CreatePeriodizationView",components:{TrainerHeader:C,AppAlert:S},data(){return{loading:!1,athletes:[],trainingMethods:[],showModal:!1,selectedMethod:{},form:{periodization_name:"",difficulty:5,competition_date:"",athlete_id:"",mesocycle_lengths:[4,4,4],selected_methods:[[],[],[]]},alert:{show:!1,type:"info",message:""}}},computed:{userFullName(){const o=JSON.parse(localStorage.getItem("user")||"{}");return`${o.first_name} ${o.last_name}`||"Trainer"},isFormValid(){return this.form.periodization_name.trim()&&this.form.athlete_id&&this.form.competition_date&&this.form.mesocycle_lengths.length>=3&&this.form.selected_methods.every(o=>o.length>0)}},methods:{showAlert(o,e){this.alert={show:!0,type:o,message:e}},async fetchAthletes(){var o;try{const e=await v.get("/users/trainer/my-athletes");this.athletes=e.data.athletes||[]}catch(e){console.error("Napaka pri nalaganju športnikov:",e),((o=e.response)==null?void 0:o.status)===401?this.$router.push("/login"):this.showAlert("error","Napaka pri nalaganju športnikov.")}},async fetchTrainingMethods(){var o;try{const e=await v.get("/users/trainer/methods");this.trainingMethods=e.data.data||[]}catch(e){console.error("Napaka pri pridobivanju metod:",e),((o=e.response)==null?void 0:o.status)===401?this.$router.push("/login"):this.showAlert("error","Napaka pri pridobivanju metod.")}},addMesocycle(){this.form.mesocycle_lengths.length<20&&(this.form.mesocycle_lengths.push(4),this.form.selected_methods.push([]))},removeMesocycle(o){this.form.mesocycle_lengths.length>3&&(this.form.mesocycle_lengths.splice(o,1),this.form.selected_methods.splice(o,1))},showMethodInfo(o){this.selectedMethod=o,this.showModal=!0},closeModal(){this.showModal=!1,this.selectedMethod={}},isMethodSelected(o,e){var d;return((d=this.form.selected_methods[e])==null?void 0:d.includes(o))||!1},getSelectedMethodsCount(o){var e;return((e=this.form.selected_methods[o])==null?void 0:e.length)||0},getSelectedMotorAbilities(o){const e=this.form.selected_methods[o]||[],d=new Set;return e.forEach(a=>{for(const s of this.trainingMethods)for(const i of s.method_groups)if(i.methods.find(p=>p.id===a)){d.add(s.motor_ability);break}}),Array.from(d)},hasMethodFromMotorAbility(o,e){const d=this.form.selected_methods[o]||[];for(const a of d){const s=this.trainingMethods.find(i=>i.motor_ability===e);if(s){for(const i of s.method_groups)if(i.methods.find(p=>p.id===a))return!0}}return!1},isMethodDisabled(o,e,d){if(this.isMethodSelected(o,e))return!1;const a=this.getSelectedMotorAbilities(e);return!!(a.length>=3&&!a.includes(d)||this.hasMethodFromMotorAbility(e,d))},toggleMethod(o,e,d){this.form.selected_methods[e]||this.$set(this.form.selected_methods,e,[]);const a=this.form.selected_methods[e],s=a.indexOf(o);s>-1?a.splice(s,1):this.getSelectedMotorAbilities(e).length<4&&!this.hasMethodFromMotorAbility(e,d)&&a.push(o)},async savePeriodization(){var o,e,d;this.loading=!0;try{const a={athlete_id:parseInt(this.form.athlete_id),difficulty:parseInt(this.form.difficulty),competition_date:this.form.competition_date,mesocycle_lengths:this.form.mesocycle_lengths.join(","),method_ids:this.form.selected_methods.map(i=>i.join(",")).join("|"),periodization_name:this.form.periodization_name.trim()};console.log("Payload:",a);const s=await v.post("/users/trainer/create-periodization",a);this.showAlert("success",s.data.message),setTimeout(()=>{this.$router.push("/trainer")},1500)}catch(a){if(console.error("Napaka pri ustvarjanju ciklizacije:",a),((o=a.response)==null?void 0:o.status)===401)this.$router.push("/login");else{const s=((d=(e=a.response)==null?void 0:e.data)==null?void 0:d.message)||"Napaka pri ustvarjanju ciklizacije";this.showAlert("error",s)}}finally{this.loading=!1}},showAlert(o,e){this.alert={show:!0,type:o,message:e}},cancelCreation(){confirm("Želiš preklicati ustvarjanje? Vse neshranjene spremembe bodo izgubljene.")&&this.$router.push("/trainer")},logout(){localStorage.removeItem("access_token"),localStorage.removeItem("user"),this.$router.push("/login")}},mounted(){if(!localStorage.getItem("access_token")){this.$router.push("/login");return}this.fetchAthletes(),this.fetchTrainingMethods(),document.addEventListener("keydown",e=>{e.key==="Escape"&&this.closeModal()})}},I={class:"min-h-screen content-bg"},F={class:"container mx-auto px-4 py-6"},D={class:"space-y-6"},E={class:"form-section rounded-xl p-6"},P={class:"mb-6"},U={class:"mb-6"},L={class:"flex items-center space-x-4"},O={class:"bg-blue-500 text-white px-3 py-1 rounded-lg font-bold min-w-[3rem] text-center"},B={class:"form-section rounded-xl p-6"},H={class:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-4 mb-4"},J={class:"block text-gray-700 font-medium mb-2"},K=["onUpdate:modelValue"],R=["onClick"],Z={class:"text-center"},q=["disabled"],G={class:"form-section rounded-xl p-6"},Q={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},W=["value"],X={class:"form-section rounded-xl p-6"},Y={class:"overflow-x-auto"},$={class:"w-full border border-gray-300 rounded-lg overflow-hidden"},ee={class:"methods-header"},te=["colspan"],se=["colspan"],oe={class:"p-3 font-medium text-gray-800 pl-14"},le={class:"flex items-center space-x-2"},ie=["onClick"],re=["checked","onChange","disabled"],ne={class:"flex space-x-4 justify-center"},ae=["disabled"],de={key:0,class:"fas fa-spinner fa-spin mr-2"},ce={key:1,class:"fas fa-save mr-2"},ue=["disabled"],me={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},fe={class:"bg-white rounded-xl max-w-md w-full p-6"},he={class:"flex justify-between items-start mb-4"},ge={class:"text-2xl font-bold text-gray-800"},pe={class:"text-gray-700 leading-relaxed"};function be(o,e,d,a,s,i){const p=w("TrainerHeader"),A=w("AppAlert");return n(),r("div",I,[k(p,{"user-full-name":i.userFullName,onLogout:i.logout},null,8,["user-full-name","onLogout"]),t("main",F,[e[24]||(e[24]=t("div",{class:"text-center mb-8"},[t("h1",{class:"text-3xl font-bold text-white mb-2"},[t("i",{class:"fas fa-plus-circle mr-3"}),f("USTVARI CIKLIZACIJO ")])],-1)),t("div",D,[t("div",E,[e[13]||(e[13]=t("h3",{class:"section-title text-xl font-bold text-gray-800 mb-4"},"Osnovne informacije",-1)),t("div",P,[e[9]||(e[9]=t("label",{class:"block text-gray-700 font-medium mb-2"},[t("i",{class:"fas fa-tag mr-2 text-blue-500"}),f("Ime ciklizacije ")],-1)),y(t("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=l=>s.form.periodization_name=l),placeholder:"Vnesi ime ciklizacije...",class:"w-full px-4 py-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200"},null,512),[[x,s.form.periodization_name]])]),t("div",U,[e[12]||(e[12]=t("label",{class:"block text-gray-700 font-medium mb-2"},[t("i",{class:"fas fa-signal mr-2 text-blue-500"}),f("Težavnost (1-10) ")],-1)),t("div",L,[e[10]||(e[10]=t("span",{class:"text-sm text-gray-600"},"1",-1)),y(t("input",{type:"range","onUpdate:modelValue":e[1]||(e[1]=l=>s.form.difficulty=l),min:"1",max:"10",class:"flex-1 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider"},null,512),[[x,s.form.difficulty]]),e[11]||(e[11]=t("span",{class:"text-sm text-gray-600"},"10",-1)),t("div",O,u(s.form.difficulty),1)])])]),t("div",B,[e[15]||(e[15]=t("h3",{class:"section-title text-xl font-bold text-gray-800 mb-4"},"Konfiguracija mezociklov",-1)),t("div",H,[(n(!0),r(m,null,h(s.form.mesocycle_lengths,(l,c)=>(n(),r("div",{key:c,class:"text-center relative"},[t("label",J,"Mezocikel "+u(c+1),1),y(t("input",{type:"number","onUpdate:modelValue":b=>s.form.mesocycle_lengths[c]=b,min:"1",max:"12",class:"w-full px-4 py-3 text-center rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200"},null,8,K),[[x,s.form.mesocycle_lengths[c]]]),s.form.mesocycle_lengths.length>3?(n(),r("button",{key:0,onClick:b=>i.removeMesocycle(c),class:"absolute -top-2 -right-2 w-6 h-6 bg-red-500 text-white rounded-full text-xs hover:bg-red-600 transition duration-200"}," × ",8,R)):M("",!0)]))),128))]),t("div",Z,[t("button",{onClick:e[2]||(e[2]=(...l)=>i.addMesocycle&&i.addMesocycle(...l)),disabled:s.form.mesocycle_lengths.length>=20,class:"add-mesocycle-btn px-6 py-3 rounded-lg font-semibold transition duration-200 disabled:opacity-50 disabled:cursor-not-allowed"},e[14]||(e[14]=[t("i",{class:"fas fa-plus mr-2"},null,-1),f("Dodaj mezocikel ")]),8,q)])]),t("div",G,[e[19]||(e[19]=t("h3",{class:"section-title text-xl font-bold text-gray-800 mb-4"},"Športnik in tekmovanje",-1)),t("div",Q,[t("div",null,[e[16]||(e[16]=t("label",{class:"block text-gray-700 font-medium mb-2"},[t("i",{class:"fas fa-calendar mr-2 text-blue-500"}),f("Dan tekmovanja ")],-1)),y(t("input",{type:"date","onUpdate:modelValue":e[3]||(e[3]=l=>s.form.competition_date=l),class:"w-full px-4 py-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200"},null,512),[[x,s.form.competition_date]])]),t("div",null,[e[18]||(e[18]=t("label",{class:"block text-gray-700 font-medium mb-2"},"Izberi športnika",-1)),y(t("select",{"onUpdate:modelValue":e[4]||(e[4]=l=>s.form.athlete_id=l),class:"w-full px-4 py-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200"},[e[17]||(e[17]=t("option",{value:""},"Izberi športnika...",-1)),(n(!0),r(m,null,h(s.athletes,l=>(n(),r("option",{key:l.id,value:l.id},u(l.first_name)+" "+u(l.last_name),9,W))),128))],512),[[N,s.form.athlete_id]])])])]),t("div",X,[e[21]||(e[21]=t("h3",{class:"section-title text-xl font-bold text-gray-800 mb-4"},"Izbira metod treninga",-1)),e[22]||(e[22]=t("p",{class:"text-gray-600 mb-4"},"Izberi 1 metodo na gibalno sposobnost, maksimalno 3 gibalne sposobnosti.",-1)),t("div",Y,[t("table",$,[t("thead",null,[t("tr",ee,[e[20]||(e[20]=t("th",{class:"p-3 text-left font-semibold"},"Metode",-1)),(n(!0),r(m,null,h(s.form.mesocycle_lengths,(l,c)=>(n(),r("th",{key:c,class:"p-3 text-center font-semibold"}," Mezo "+u(c+1),1))),128))])]),t("tbody",null,[(n(!0),r(m,null,h(s.trainingMethods,(l,c)=>(n(),r(m,{key:"ability-"+c},[t("tr",null,[t("td",{colspan:s.form.mesocycle_lengths.length+1,class:"bg-blue-50 font-bold text-2xl py-4 text-blue-900"},u(l.motor_ability),9,te)]),(n(!0),r(m,null,h(l.method_groups,(b,j)=>(n(),r(m,{key:"group-"+c+"-"+j},[t("tr",null,[t("td",{colspan:s.form.mesocycle_lengths.length+1,class:"bg-blue-100 font-semibold text-lg py-3 text-blue-700 pl-8"},u(b.group_name),9,se)]),(n(!0),r(m,null,h(b.methods,g=>(n(),r("tr",{key:g.id,class:"border-t hover:bg-gray-50"},[t("td",oe,[t("div",le,[t("span",null,u(g.name),1),t("button",{onClick:z=>i.showMethodInfo(g),class:"info-button w-5 h-5 bg-blue-500 text-white rounded-full text-xs hover:bg-blue-600 transition duration-200"}," i ",8,ie)])]),(n(!0),r(m,null,h(s.form.mesocycle_lengths,(z,_)=>(n(),r("td",{key:_,class:"p-3 text-center"},[t("input",{type:"checkbox",checked:i.isMethodSelected(g.id,_),onChange:ye=>i.toggleMethod(g.id,_,l.motor_ability),disabled:i.isMethodDisabled(g.id,_,l.motor_ability),class:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 focus:ring-2"},null,40,re)]))),128))]))),128))],64))),128))],64))),128))])])])]),t("div",ne,[t("button",{onClick:e[5]||(e[5]=(...l)=>i.savePeriodization&&i.savePeriodization(...l)),disabled:s.loading||!i.isFormValid,class:"save-btn px-8 py-4 rounded-xl font-bold text-lg transition duration-300 disabled:opacity-50 disabled:cursor-not-allowed"},[s.loading?(n(),r("i",de)):(n(),r("i",ce)),f(" "+u(s.loading?"Saving...":"SAVE PERIODIZATION"),1)],8,ae),t("button",{onClick:e[6]||(e[6]=(...l)=>i.cancelCreation&&i.cancelCreation(...l)),disabled:s.loading,class:"cancel-btn px-8 py-4 rounded-xl font-bold text-lg transition duration-300 disabled:opacity-50"},e[23]||(e[23]=[t("i",{class:"fas fa-times mr-2"},null,-1),f("CANCEL ")]),8,ue)])])]),s.showModal?(n(),r("div",me,[t("div",fe,[t("div",he,[t("h1",ge,u(s.selectedMethod.name),1),t("button",{onClick:e[7]||(e[7]=(...l)=>i.closeModal&&i.closeModal(...l)),class:"text-gray-500 hover:text-gray-700 text-2xl"},"×")]),t("p",pe,u(s.selectedMethod.description),1)])])):M("",!0),k(A,{visible:s.alert.show,type:s.alert.type,message:s.alert.message,onClose:e[8]||(e[8]=l=>s.alert.show=!1)},null,8,["visible","type","message"])])}const Me=V(T,[["render",be],["__scopeId","data-v-f5568112"]]);export{Me as default};
