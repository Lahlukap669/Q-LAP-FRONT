import{a as v,A as k}from"./api-BJgnF3hB.js";import{T as S}from"./TrainerHeader-DWaHe2Wg.js";import{A as N}from"./AppAlert-jdCgL8S3.js";import{_ as I,c as r,e as M,a as t,b as w,f as A,d as h,k as y,v as x,t as u,F as m,j as f,l as V,o as n}from"./index-CZfNrfaq.js";const T={name:"CreatePeriodizationView",components:{TrainerHeader:S,AppAlert:N},data(){return{loading:!1,athletes:[],trainingMethods:[],showModal:!1,selectedMethod:{},form:{periodization_name:"",difficulty:5,competition_date:"",athlete_id:"",mesocycle_lengths:[4,4,4],selected_methods:[[],[],[]]},alert:{show:!1,type:"info",message:""}}},computed:{userFullName(){const s=JSON.parse(localStorage.getItem("user")||"{}");return`${s.first_name} ${s.last_name}`||"Trainer"},isFormValid(){return this.form.periodization_name.trim()&&this.form.athlete_id&&this.form.competition_date&&this.form.mesocycle_lengths.length>=3&&this.form.selected_methods.every(s=>s.length>0)}},methods:{showAlert(s,e){this.alert={show:!0,type:s,message:e}},async fetchAthletes(){try{const s=localStorage.getItem("access_token"),e=await v.get(`${k.LOGIN.replace("/auth/login","")}/users/trainer/my-athletes`,{headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"}});this.athletes=e.data.athletes||[]}catch(s){console.error("Napaka pri nalaganju športnikov:",s),this.showAlert("error","Napaka pri nalaganju športnikov.")}},async fetchTrainingMethods(){try{const s=localStorage.getItem("access_token"),e=await v.get(`${k.LOGIN.replace("/auth/login","")}/users/trainer/methods`,{headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"}});this.trainingMethods=e.data.data||[]}catch(s){console.error("Napaka pri pridobivanju metod:",s),this.showAlert("error","Napaka pri pridobivanju metod.")}},addMesocycle(){this.form.mesocycle_lengths.length<20&&(this.form.mesocycle_lengths.push(4),this.form.selected_methods.push([]))},removeMesocycle(s){this.form.mesocycle_lengths.length>3&&(this.form.mesocycle_lengths.splice(s,1),this.form.selected_methods.splice(s,1))},showMethodInfo(s){this.selectedMethod=s,this.showModal=!0},closeModal(){this.showModal=!1,this.selectedMethod={}},isMethodSelected(s,e){var a;return((a=this.form.selected_methods[e])==null?void 0:a.includes(s))||!1},getSelectedMethodsCount(s){var e;return((e=this.form.selected_methods[s])==null?void 0:e.length)||0},getSelectedMotorAbilities(s){const e=this.form.selected_methods[s]||[],a=new Set;return e.forEach(d=>{for(const o of this.trainingMethods)for(const i of o.method_groups)if(i.methods.find(p=>p.id===d)){a.add(o.motor_ability);break}}),Array.from(a)},hasMethodFromMotorAbility(s,e){const a=this.form.selected_methods[s]||[];for(const d of a){const o=this.trainingMethods.find(i=>i.motor_ability===e);if(o){for(const i of o.method_groups)if(i.methods.find(p=>p.id===d))return!0}}return!1},isMethodDisabled(s,e,a){if(this.isMethodSelected(s,e))return!1;const d=this.getSelectedMotorAbilities(e);return!!(d.length>=3&&!d.includes(a)||this.hasMethodFromMotorAbility(e,a))},toggleMethod(s,e,a){this.form.selected_methods[e]||this.$set(this.form.selected_methods,e,[]);const d=this.form.selected_methods[e],o=d.indexOf(s);o>-1?d.splice(o,1):this.getSelectedMotorAbilities(e).length<4&&!this.hasMethodFromMotorAbility(e,a)&&d.push(s)},async savePeriodization(){var s,e;this.loading=!0;try{const a=localStorage.getItem("access_token"),d={athlete_id:parseInt(this.form.athlete_id),difficulty:parseInt(this.form.difficulty),competition_date:this.form.competition_date,mesocycle_lengths:this.form.mesocycle_lengths.join(","),method_ids:this.form.selected_methods.map(i=>i.join(",")).join("|"),periodization_name:this.form.periodization_name.trim()};console.log("Payload:",d);const o=await v.post(`${k.LOGIN.replace("/auth/login","")}/users/trainer/create-periodization`,d,{headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}});this.showAlert("success",o.data.message),setTimeout(()=>{this.$router.push("/trainer")},1500)}catch(a){console.error("Napaka pri ustvarjanju ciklizacije:",a);const d=((e=(s=a.response)==null?void 0:s.data)==null?void 0:e.message)||"Napaka pri ustvarjanju ciklizacije";this.showAlert("error",d)}finally{this.loading=!1}},cancelCreation(){confirm("Želiš preklicati ustvarjanje? Vse neshranjene spremembe bodo izgubljene.")&&this.$router.push("/trainer")},logout(){localStorage.removeItem("access_token"),localStorage.removeItem("user"),this.$router.push("/login")}},mounted(){if(!localStorage.getItem("access_token")){this.$router.push("/login");return}this.fetchAthletes(),this.fetchTrainingMethods(),document.addEventListener("keydown",e=>{e.key==="Escape"&&this.closeModal()})}},O={class:"min-h-screen content-bg"},F={class:"container mx-auto px-4 py-6"},L={class:"space-y-6"},P={class:"form-section rounded-xl p-6"},D={class:"mb-6"},E={class:"mb-6"},U={class:"flex items-center space-x-4"},B={class:"bg-blue-500 text-white px-3 py-1 rounded-lg font-bold min-w-[3rem] text-center"},G={class:"form-section rounded-xl p-6"},H={class:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-4 mb-4"},J={class:"block text-gray-700 font-medium mb-2"},K=["onUpdate:modelValue"],R=["onClick"],Z={class:"text-center"},q=["disabled"],Q={class:"form-section rounded-xl p-6"},W={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},X=["value"],Y={class:"form-section rounded-xl p-6"},$={class:"overflow-x-auto"},ee={class:"w-full border border-gray-300 rounded-lg overflow-hidden"},te={class:"methods-header"},oe=["colspan"],se=["colspan"],le={class:"p-3 font-medium text-gray-800 pl-14"},ie={class:"flex items-center space-x-2"},re=["onClick"],ne=["checked","onChange","disabled"],ae={class:"flex space-x-4 justify-center"},de=["disabled"],ce={key:0,class:"fas fa-spinner fa-spin mr-2"},ue={key:1,class:"fas fa-save mr-2"},me=["disabled"],he={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},fe={class:"bg-white rounded-xl max-w-md w-full p-6"},ge={class:"flex justify-between items-start mb-4"},pe={class:"text-2xl font-bold text-gray-800"},be={class:"text-gray-700 leading-relaxed"};function ye(s,e,a,d,o,i){const p=A("TrainerHeader"),j=A("AppAlert");return n(),r("div",O,[M(p,{"user-full-name":i.userFullName,onLogout:i.logout},null,8,["user-full-name","onLogout"]),t("main",F,[e[24]||(e[24]=t("div",{class:"text-center mb-8"},[t("h1",{class:"text-3xl font-bold text-white mb-2"},[t("i",{class:"fas fa-plus-circle mr-3"}),h("USTVARI CIKLIZACIJO ")])],-1)),t("div",L,[t("div",P,[e[13]||(e[13]=t("h3",{class:"section-title text-xl font-bold text-gray-800 mb-4"},"Osnovne informacije",-1)),t("div",D,[e[9]||(e[9]=t("label",{class:"block text-gray-700 font-medium mb-2"},[t("i",{class:"fas fa-tag mr-2 text-blue-500"}),h("Ime ciklizacije ")],-1)),y(t("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=l=>o.form.periodization_name=l),placeholder:"Vnesi ime ciklizacije...",class:"w-full px-4 py-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200"},null,512),[[x,o.form.periodization_name]])]),t("div",E,[e[12]||(e[12]=t("label",{class:"block text-gray-700 font-medium mb-2"},[t("i",{class:"fas fa-signal mr-2 text-blue-500"}),h("Težavnost (1-10) ")],-1)),t("div",U,[e[10]||(e[10]=t("span",{class:"text-sm text-gray-600"},"1",-1)),y(t("input",{type:"range","onUpdate:modelValue":e[1]||(e[1]=l=>o.form.difficulty=l),min:"1",max:"10",class:"flex-1 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider"},null,512),[[x,o.form.difficulty]]),e[11]||(e[11]=t("span",{class:"text-sm text-gray-600"},"10",-1)),t("div",B,u(o.form.difficulty),1)])])]),t("div",G,[e[15]||(e[15]=t("h3",{class:"section-title text-xl font-bold text-gray-800 mb-4"},"Konfiguracija mezociklov",-1)),t("div",H,[(n(!0),r(m,null,f(o.form.mesocycle_lengths,(l,c)=>(n(),r("div",{key:c,class:"text-center relative"},[t("label",J,"Mezocikel "+u(c+1),1),y(t("input",{type:"number","onUpdate:modelValue":b=>o.form.mesocycle_lengths[c]=b,min:"1",max:"12",class:"w-full px-4 py-3 text-center rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200"},null,8,K),[[x,o.form.mesocycle_lengths[c]]]),o.form.mesocycle_lengths.length>3?(n(),r("button",{key:0,onClick:b=>i.removeMesocycle(c),class:"absolute -top-2 -right-2 w-6 h-6 bg-red-500 text-white rounded-full text-xs hover:bg-red-600 transition duration-200"}," × ",8,R)):w("",!0)]))),128))]),t("div",Z,[t("button",{onClick:e[2]||(e[2]=(...l)=>i.addMesocycle&&i.addMesocycle(...l)),disabled:o.form.mesocycle_lengths.length>=20,class:"add-mesocycle-btn px-6 py-3 rounded-lg font-semibold transition duration-200 disabled:opacity-50 disabled:cursor-not-allowed"},e[14]||(e[14]=[t("i",{class:"fas fa-plus mr-2"},null,-1),h("Dodaj mezocikel ")]),8,q)])]),t("div",Q,[e[19]||(e[19]=t("h3",{class:"section-title text-xl font-bold text-gray-800 mb-4"},"Športnik in tekmovanje",-1)),t("div",W,[t("div",null,[e[16]||(e[16]=t("label",{class:"block text-gray-700 font-medium mb-2"},[t("i",{class:"fas fa-calendar mr-2 text-blue-500"}),h("Dan tekmovanja ")],-1)),y(t("input",{type:"date","onUpdate:modelValue":e[3]||(e[3]=l=>o.form.competition_date=l),class:"w-full px-4 py-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200"},null,512),[[x,o.form.competition_date]])]),t("div",null,[e[18]||(e[18]=t("label",{class:"block text-gray-700 font-medium mb-2"},"Izberi športnika",-1)),y(t("select",{"onUpdate:modelValue":e[4]||(e[4]=l=>o.form.athlete_id=l),class:"w-full px-4 py-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200"},[e[17]||(e[17]=t("option",{value:""},"Izberi športnika...",-1)),(n(!0),r(m,null,f(o.athletes,l=>(n(),r("option",{key:l.id,value:l.id},u(l.first_name)+" "+u(l.last_name),9,X))),128))],512),[[V,o.form.athlete_id]])])])]),t("div",Y,[e[21]||(e[21]=t("h3",{class:"section-title text-xl font-bold text-gray-800 mb-4"},"Izbira metod treninga",-1)),e[22]||(e[22]=t("p",{class:"text-gray-600 mb-4"},"Izberi 1 metodo na gibalno sposobnost, maksimalno 3 gibalne sposobnosti.",-1)),t("div",$,[t("table",ee,[t("thead",null,[t("tr",te,[e[20]||(e[20]=t("th",{class:"p-3 text-left font-semibold"},"Metode",-1)),(n(!0),r(m,null,f(o.form.mesocycle_lengths,(l,c)=>(n(),r("th",{key:c,class:"p-3 text-center font-semibold"}," Mezo "+u(c+1),1))),128))])]),t("tbody",null,[(n(!0),r(m,null,f(o.trainingMethods,(l,c)=>(n(),r(m,{key:"ability-"+c},[t("tr",null,[t("td",{colspan:o.form.mesocycle_lengths.length+1,class:"bg-blue-50 font-bold text-2xl py-4 text-blue-900"},u(l.motor_ability),9,oe)]),(n(!0),r(m,null,f(l.method_groups,(b,z)=>(n(),r(m,{key:"group-"+c+"-"+z},[t("tr",null,[t("td",{colspan:o.form.mesocycle_lengths.length+1,class:"bg-blue-100 font-semibold text-lg py-3 text-blue-700 pl-8"},u(b.group_name),9,se)]),(n(!0),r(m,null,f(b.methods,g=>(n(),r("tr",{key:g.id,class:"border-t hover:bg-gray-50"},[t("td",le,[t("div",ie,[t("span",null,u(g.name),1),t("button",{onClick:C=>i.showMethodInfo(g),class:"info-button w-5 h-5 bg-blue-500 text-white rounded-full text-xs hover:bg-blue-600 transition duration-200"}," i ",8,re)])]),(n(!0),r(m,null,f(o.form.mesocycle_lengths,(C,_)=>(n(),r("td",{key:_,class:"p-3 text-center"},[t("input",{type:"checkbox",checked:i.isMethodSelected(g.id,_),onChange:_e=>i.toggleMethod(g.id,_,l.motor_ability),disabled:i.isMethodDisabled(g.id,_,l.motor_ability),class:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 focus:ring-2"},null,40,ne)]))),128))]))),128))],64))),128))],64))),128))])])])]),t("div",ae,[t("button",{onClick:e[5]||(e[5]=(...l)=>i.savePeriodization&&i.savePeriodization(...l)),disabled:o.loading||!i.isFormValid,class:"save-btn px-8 py-4 rounded-xl font-bold text-lg transition duration-300 disabled:opacity-50 disabled:cursor-not-allowed"},[o.loading?(n(),r("i",ce)):(n(),r("i",ue)),h(" "+u(o.loading?"Saving...":"SAVE PERIODIZATION"),1)],8,de),t("button",{onClick:e[6]||(e[6]=(...l)=>i.cancelCreation&&i.cancelCreation(...l)),disabled:o.loading,class:"cancel-btn px-8 py-4 rounded-xl font-bold text-lg transition duration-300 disabled:opacity-50"},e[23]||(e[23]=[t("i",{class:"fas fa-times mr-2"},null,-1),h("CANCEL ")]),8,me)])])]),o.showModal?(n(),r("div",he,[t("div",fe,[t("div",ge,[t("h1",pe,u(o.selectedMethod.name),1),t("button",{onClick:e[7]||(e[7]=(...l)=>i.closeModal&&i.closeModal(...l)),class:"text-gray-500 hover:text-gray-700 text-2xl"},"×")]),t("p",be,u(o.selectedMethod.description),1)])])):w("",!0),M(j,{visible:o.alert.show,type:o.alert.type,message:o.alert.message,onClose:e[8]||(e[8]=l=>o.alert.show=!1)},null,8,["visible","type","message"])])}const we=I(T,[["render",ye],["__scopeId","data-v-090abd66"]]);export{we as default};
